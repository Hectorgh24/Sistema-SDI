<!DOCTYPE html>
<html>
<head>
    <title>Test API Directo</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #f0f0f0; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .output { background: #222; color: #0f0; padding: 15px; border-radius: 5px; margin: 20px 0; overflow-x: auto; }
        .success { color: #0f0; }
        .error { color: #f00; }
    </style>
</head>
<body>
<div class="container">
    <h1>Test Directo de API Carpetas</h1>
    
    <div>
        <button onclick="testListar()">1. Listar Carpetas</button>
        <button onclick="testCrear()">2. Crear Carpeta</button>
        <button onclick="testDiagnostico()">3. Diagn√≥stico BD</button>
        <button onclick="limpiar()">Limpiar</button>
    </div>
    
    <div class="output" id="output">Esperando pruebas...</div>
</div>

<script>
const log = (msg, tipo = 'info') => {
    const output = document.getElementById('output');
    const line = document.createElement('div');
    line.className = tipo;
    line.textContent = msg;
    output.appendChild(line);
    output.scrollTop = output.scrollHeight;
};

const limpiar = () => {
    document.getElementById('output').innerHTML = '';
};

const testListar = async () => {
    log('üì• Listando carpetas...', 'info');
    try {
        const res = await fetch('/Programa-Gestion-SDI/api/carpetas', {
            credentials: 'include'
        });
        const data = await res.json();
        log('‚úì Respuesta: ' + JSON.stringify(data, null, 2), 'success');
    } catch (e) {
        log('‚úó Error: ' + e.message, 'error');
    }
};

const testCrear = async () => {
    log('üì§ Creando carpeta...', 'info');
    try {
        const datos = {
            no_carpeta_fisica: Math.floor(Math.random() * 100),
            titulo: 'Test ' + Date.now(),
            etiqueta_identificadora: 'TEST-' + Date.now(),
            descripcion: 'Prueba autom√°tica',
            estado_gestion: 'pendiente'
        };
        log('Datos: ' + JSON.stringify(datos, null, 2), 'info');
        
        const res = await fetch('/Programa-Gestion-SDI/api/carpetas/crear', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify(datos)
        });
        const data = await res.json();
        log('‚úì Respuesta: ' + JSON.stringify(data, null, 2), data.success ? 'success' : 'error');
    } catch (e) {
        log('‚úó Error: ' + e.message, 'error');
    }
};

const testDiagnostico = async () => {
    log('üîç Ejecutando diagn√≥stico...', 'info');
    try {
        const res = await fetch('/Programa-Gestion-SDI/diagnostico_completo.php', {
            credentials: 'include'
        });
        const html = await res.text();
        log('‚úì Diagn√≥stico cargado', 'success');
        // Mostrar en nuevo tab
        const newTab = window.open();
        newTab.document.write(html);
    } catch (e) {
        log('‚úó Error: ' + e.message, 'error');
    }
};
</script>
</body>
</html>
